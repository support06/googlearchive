<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
 Copyright 2008 Google Inc. 
 Licensed under the Apache License, Version 2.0: 
 http://www.apache.org/licenses/LICENSE-2.0 
 -->
<html xmlns="http://www.w3.org/1999/xhtml" 
xmlns:v="urn:schemas-microsoft-com:vml">
  <head>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAjU0EJWnWPMv7oQ-jjS7dYxSPW5CJgpdgO_s4yyMovOaVh_KvvhSfpvagV18eOyDWu7VytS6Bi1CWxw"
      type="text/javascript"></script>
    <style type="text/css">
    v\:* {
      behavior:url(#default#VML);
    }
    </style>
    <script type="text/javascript"> 
   
    var map;

function onLoad() {
  if (GBrowserIsCompatible()) {
    map = new GMap2(document.getElementById("map")); 
    map.addControl(new GLargeMapControl());
    map.setCenter(new GLatLng(36.108575, -115.174528), 14); 
    map.addControl(new GLargeMapControl());
    var icon = new GIcon(G_DEFAULT_ICON);
    icon.image = "http://picasaweb.google.com/s/v/21.10/img/marker-shadow.png";
    icon.shadow = "http://picasaweb.google.com/s/v/21.10/img/marker-shadow.png";
    icon.iconSize = new GSize(32, 32);
    icon.shadowSize = new GSize(59, 32);
    icon.iconAnchor = new GPoint(6, 20);
    icon.infoWindowAnchor = new GPoint(5, 1);

    var photoToDrag = new GDraggableObject(document.getElementById("photoToDrag"));
    GEvent.addListener(photoToDrag, "dragend", function() {
      var ep = getElementPosition(document.getElementById("photoToDrag"));
      GLog.write(ep.left + "," + ep.top);
      var latlng = map.fromContainerPixelToLatLng(new GPoint(ep.left+16, ep.top+16));
      var marker = new GMarker(latlng, {draggable:true, icon: icon});
      marker.setImage("http://lh3.google.com/picasateam/RoBHdfTZ7OI/AAAAAAAAABk/lb6AdOpWiZk/s72/IMG_0185.JPG");
      map.addOverlay(marker);
//      document.getElementById("photoToDrag").style.width = "0px";
//      document.getElementById("photoToDrag").style.height = "0px";
    });
     var geoXml = new GGeoXml("http://picasaweb.google.com/data/feed/base/user/picasateam/albumid/5080138758345059425?kind=photo&alt=kml&hl=en_US");
    map.addOverlay(geoXml);
  }
} 

function getElementPosition(element) {
  var leftPos = element.offsetLeft;          // initialize var to store calculations
  var topPos = element.offsetTop;            // initialize var to store calculations
  var parElement = element.offsetParent;     // identify first offset parent element  
  while (parElement != null ) {                // move up through element hierarchy
    leftPos += parElement.offsetLeft;      // appending left offset of each parent
    topPos += parElement.offsetTop;  
    parElement = parElement.offsetParent;  // until no more offset parents exist
  }
  return {left: leftPos, top: topPos};
}

</script>
  </head>

  <body onload="onLoad()">
    <img src="http://lh3.google.com/picasateam/RoBHdfTZ7OI/AAAAAAAAABk/lb6AdOpWiZk/s72/IMG_0185.JPG" style="z-index:104" width="32" height="32" id="photoToDrag"/>
    <div id="map" style="width: 500px; height: 480px; float:left; border: 1px solid black;"></div>
    </div>

  </body>
</html>
